!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MetaPNG={})}(this,(function(t){"use strict";function e(t){const e=new ArrayBuffer(4),n=new DataView(e);return n.setUint32(0,t),new Uint8Array(n.buffer)}function n(t,e=0,n=t.byteLength){let r="";const o=Math.min(n,t.byteLength-e);for(let n=0;n<o;n+=1)r+=String.fromCharCode(t.getUint8(e+n));return r}function r(t){return(new TextEncoder).encode(t)}function o(t){const e=t.reduce(((t,e)=>t+e.byteLength),0),n=new Uint8Array(e);for(let e=0,r=0;e<t.length;e+=1)n.set(t[e],r),r+=t[e].byteLength;return n}function i(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function a(t){const e=new Uint8Array([137,80,78,71,13,10,26,10]);return!(t.length<e.length)&&i(e).getBigUint64()===i(t).getBigUint64()}const f=[];function g(t,n,g){if(!a(t))throw new TypeError("Invalid PNG");if(n.length<1||n.length>79)throw new TypeError("Invalid length for key");const u=r("tEXt"),l=r(`${n}\0${g}`),s=e(function(t){if(0===f.length)for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;f[t]=e}const e=4294967295;return(((t,e,n)=>{let r=t;for(let t=0;t<n;t++)r=f[255&(r^e[t])]^r>>>8;return r})(e,t,t.byteLength)^e)>>>0}(o([u,l]))),c=o([e(l.byteLength),u,l,s]),h=16+i(t).getUint32(8)+4;return o([t.subarray(0,h),c,t.subarray(h)])}t.addMetadata=g,t.addMetadataFromBase64DataURI=function(t,e,r){const o="data:image/png;base64,";if("string"!=typeof t||t.substring(0,o.length)!==o)throw new TypeError("Invalid PNG as Base64 Data URI");const a=atob(t.substring(o.length)),f=new Uint8Array(a.length);for(let t=0;t<a.length;t+=1)f[t]=a.charCodeAt(t);const u=g(f,e,r);return o+btoa(n(i(u)))},t.getMetadata=function(t,e){if(!a(t))throw new TypeError("Invalid PNG");const r=i(t);let o=8;for(;o<r.byteLength;){const t=r.getUint32(o);if(n(r,o+4,4+e.length)===`tEXt${e}`)return n(r,o+4+4+e.length+1,t-e.length-1);o+=t+12}},Object.defineProperty(t,"__esModule",{value:!0})}));
